# Synology NAS Deployment Files

This directory contains all files needed to deploy Bitcorp ERP on a Synology NAS.

## ğŸ“ Files Overview

### `docker-compose.synology.yml`
**Purpose**: Production-ready Docker Compose configuration optimized for Synology NAS.

**Features**:
- âœ… Separate networks for frontend/backend isolation
- âœ… Persistent volumes for data storage
- âœ… Health checks for all services
- âœ… Celery workers for async task processing
- âœ… Comprehensive inline documentation
- âœ… Interview preparation notes

**Services Included**:
- PostgreSQL 15 (Database)
- Redis 7 (Cache & Message Broker)
- FastAPI Backend (Business Logic)
- Next.js Frontend (Admin & Mobile UI)
- Celery Worker (Async Tasks)
- Celery Beat (Task Scheduler)
- pgAdmin (Database Management)

### `.env.synology.example`
**Purpose**: Template for environment variables with secure defaults.

**Contents**:
- Database credentials
- Redis authentication
- JWT secret keys
- API endpoints
- Port configurations
- Localization settings

**Usage**: Copy to `/volume1/docker/bitcorp/.env` and customize.

### `scripts/setup-synology.sh`
**Purpose**: Automated setup script for first-time deployment.

**What it does**:
1. âœ… Validates prerequisites (Docker, directories)
2. âœ… Creates required directories with proper permissions
3. âœ… Generates secure passwords automatically
4. âœ… Creates `.env` file with generated credentials
5. âœ… Validates Docker Compose configuration
6. âœ… Provides step-by-step deployment instructions

**Usage**:
```bash
sudo bash scripts/setup-synology.sh
```

### `docs/SYNOLOGY_DEPLOYMENT_GUIDE.md`
**Purpose**: Comprehensive deployment and maintenance guide.

**Sections**:
- ğŸ“‹ Prerequisites & requirements
- ğŸš€ Step-by-step installation
- ğŸ” Security hardening
- ğŸ“Š Monitoring & maintenance
- ğŸ› Troubleshooting
- ğŸ”„ CI/CD integration
- ğŸ“± Mobile access configuration

## ğŸš€ Quick Start

### Option 1: Automated Setup (Recommended)

```bash
# 1. SSH into Synology
ssh admin@your-synology-ip

# 2. Navigate to codebase
cd /volume1/PeruFamilyDocs/BitCorp/bitcorp

# 3. Run setup script
sudo bash scripts/setup-synology.sh

# 4. Follow the on-screen instructions
```

### Option 2: Manual Setup

```bash
# 1. Create runtime directory
sudo mkdir -p /volume1/docker/bitcorp

# 2. Copy files
sudo cp docker-compose.synology.yml /volume1/docker/bitcorp/docker-compose.yml
sudo cp .env.synology.example /volume1/docker/bitcorp/.env

# 3. Edit .env with your settings
sudo nano /volume1/docker/bitcorp/.env

# 4. Create required directories
sudo mkdir -p /volume1/PeruFamilyDocs/BitCorp/bitcorp/backend/logs
sudo mkdir -p /volume1/PeruFamilyDocs/BitCorp/bitcorp/database/backups

# 5. Deploy
cd /volume1/docker/bitcorp
sudo docker-compose up -d
```

## ğŸ“ Directory Structure on Synology

```
/volume1/
â”œâ”€â”€ docker/
â”‚   â””â”€â”€ bitcorp/                    â† Runtime location
â”‚       â”œâ”€â”€ docker-compose.yml      â† Copied from docker-compose.synology.yml
â”‚       â”œâ”€â”€ .env                     â† Copied from .env.synology.example
â”‚       â””â”€â”€ CREDENTIALS.txt         â† Generated by setup script
â”‚
â””â”€â”€ PeruFamilyDocs/
    â””â”€â”€ BitCorp/
        â””â”€â”€ bitcorp/                â† Codebase location
            â”œâ”€â”€ backend/
            â”‚   â”œâ”€â”€ app/
            â”‚   â”œâ”€â”€ logs/           â† Created by setup
            â”‚   â””â”€â”€ ...
            â”œâ”€â”€ frontend/
            â”‚   â””â”€â”€ ...
            â”œâ”€â”€ database/
            â”‚   â””â”€â”€ backups/        â† Created by setup
            â””â”€â”€ ...
```

## ğŸ” Security Considerations

### Generated Credentials
The setup script generates secure random passwords for:
- PostgreSQL database
- Redis authentication
- JWT secret keys
- pgAdmin access

**IMPORTANT**: After setup, credentials are saved to:
```
/volume1/docker/bitcorp/CREDENTIALS.txt
```

**âš ï¸ Store these securely and DELETE the file after recording!**

### Firewall Configuration
Open these ports on your Synology firewall (Control Panel > Security > Firewall):

| Port | Service | Access |
|------|---------|--------|
| 3000 | Frontend | Local network |
| 8000 | Backend API | Local network |
| 5433 | PostgreSQL | Localhost only |
| 6379 | Redis | Localhost only |
| 5050 | pgAdmin | Local network (disable in production) |

### Production Hardening

1. **Disable pgAdmin**: Comment out in `docker-compose.yml`
2. **Enable HTTPS**: Use Synology reverse proxy with Let's Encrypt
3. **Restrict Database**: Change ports to bind only to localhost
4. **Update CORS**: Edit `backend/app/core/config.py` with production URLs
5. **Regular Updates**: Run `docker-compose pull` weekly

## ğŸ“Š Monitoring

### Check Service Status
```bash
cd /volume1/docker/bitcorp
sudo docker-compose ps
```

### View Logs
```bash
# All services
sudo docker-compose logs -f

# Specific service
sudo docker-compose logs -f backend

# Last 100 lines
sudo docker-compose logs --tail=100
```

### Health Checks
```bash
# Backend API
curl http://localhost:8000/health

# Frontend
curl http://localhost:3000

# Database
sudo docker-compose exec db psql -U bitcorp -d bitcorp_erp -c "SELECT version();"
```

## ğŸ”§ Maintenance

### Update Application
```bash
cd /volume1/PeruFamilyDocs/BitCorp/bitcorp
git pull origin main

cd /volume1/docker/bitcorp
sudo docker-compose build --no-cache
sudo docker-compose up -d
```

### Backup Database
```bash
# Manual backup
sudo docker-compose exec db pg_dump -U bitcorp bitcorp_erp | gzip > backup_$(date +%Y%m%d).sql.gz

# Restore backup
gunzip < backup_20250120.sql.gz | sudo docker-compose exec -T db psql -U bitcorp bitcorp_erp
```

### Restart Services
```bash
# All services
sudo docker-compose restart

# Specific service
sudo docker-compose restart backend
```

## ğŸ› Troubleshooting

### Services Won't Start
```bash
# Check logs
sudo docker-compose logs backend

# Validate configuration
sudo docker-compose config

# Check port conflicts
sudo netstat -tulpn | grep -E ':(3000|8000|5433|6379|5050)'
```

### Database Connection Issues
```bash
# Verify database is healthy
sudo docker-compose ps db

# Test connection
sudo docker-compose exec db psql -U bitcorp -d bitcorp_erp

# Check network
sudo docker-compose exec backend ping db
```

### Permission Errors
```bash
# Fix log directory permissions
sudo chown -R 1000:1000 /volume1/PeruFamilyDocs/BitCorp/bitcorp/backend/logs
sudo chmod -R 755 /volume1/PeruFamilyDocs/BitCorp/bitcorp/backend/logs
```

## ğŸ“š Documentation

For detailed information, see:

- **Complete Deployment Guide**: `docs/SYNOLOGY_DEPLOYMENT_GUIDE.md`
- **Docker Compose Reference**: Inline comments in `docker-compose.synology.yml`
- **Environment Variables**: Comments in `.env.synology.example`
- **Setup Script**: Comments in `scripts/setup-synology.sh`

## ğŸ“ Learning Notes

Each deployment file includes extensive educational comments covering:

- **Why** specific technologies are chosen
- **How** services communicate and integrate
- **Performance** considerations and optimizations
- **Security** implications and best practices
- **Interview Q&A** for common questions
- **Book references** to `/books` folder resources

These notes help you:
- âœ… Understand the architecture
- âœ… Make informed configuration decisions
- âœ… Troubleshoot issues effectively
- âœ… Prepare for technical interviews
- âœ… Learn industry best practices

## ğŸ”— Related Resources

### Docker & Containerization
- [Docker Documentation](https://docs.docker.com/)
- [Docker Compose Reference](https://docs.docker.com/compose/)
- [Synology Docker Guide](https://www.synology.com/en-global/dsm/packages/Docker)

### Application Stack
- [FastAPI Deployment](https://fastapi.tiangolo.com/deployment/)
- [Next.js Docker](https://nextjs.org/docs/deployment)
- [PostgreSQL in Docker](https://hub.docker.com/_/postgres)
- [Redis Documentation](https://redis.io/docs/)

### Books (in `/books` folder)
- "Designing Data-Intensive Applications" - System design
- "Clean Code in Python" - Python best practices
- "API Design Patterns" - REST API design
- "Patterns of Enterprise Application Architecture" - Architecture patterns

## ğŸ†˜ Getting Help

1. **Check Logs**: Most issues can be diagnosed from container logs
2. **Review Guide**: Complete troubleshooting section in deployment guide
3. **Validate Config**: Use `docker-compose config` to check syntax
4. **Test Connectivity**: Verify networks and health checks
5. **Report Issues**: Include logs and system info when asking for help

## ğŸ“ Changelog

### Version 1.0.0 (January 2025)
- âœ… Initial Synology deployment configuration
- âœ… Automated setup script
- âœ… Comprehensive documentation
- âœ… Security hardening guidelines
- âœ… Educational comments and interview preparation notes

---

**Maintainer**: asjadaugust  
**Last Updated**: January 2025  
**License**: Internal Use Only
